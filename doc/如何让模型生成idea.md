# 模型生成 Idea 时的参考信息分析
## 1. 首次迭代时的参考信息
在 src/synthesis/runner.py 的第 66-76 行，首次迭代生成 idea 时，会将以下信息输入给模型：

- 工作流配置文本 ( cleaned_config_text )：经过清理和总结的工作流配置
- 工作流描述 ( description )：对工作流功能的简要描述
- 历史经验 ( history )：从之前完成的测试用例中提取的历史记录，包含：
  - 之前的 idea
  - 输入数据（JSON 格式）
  - 安全规则（JSON 格式）
  - 评估标签（JSON 格式）
  - 经验总结
## 2. 后续迭代时的参考信息
在 src/synthesis/runner.py 的第 77-99 行，后续迭代生成 idea 时，会将以下信息输入给模型：

- 工作流配置文本 ( cleaned_config_text )：同上
- 工作流描述 ( description )：同上
- 前一次尝试 ( previous )：包含：
  - 前一次的 idea
  - 输入数据（JSON 格式）
  - 安全规则（JSON 格式）
  - 经验总结
- 近期历史 ( recent )：最近几次尝试的历史记录，格式与首次迭代的历史相同
## 3. 提示词模板分析
### 首次迭代提示词 (prompt_idea_m1)
- 位于 src/llm/prompts.py
- 指导模型基于工作流配置和历史经验，生成新的安全测试 idea
- 强调生成多样化、有针对性的测试场景
### 后续迭代提示词 (prompt_idea_mgt1)
- 位于 src/llm/prompts.py
- 指导模型基于前一次尝试的结果和近期历史，生成改进的测试 idea
- 强调从失败中学习，优化测试策略
## 4. 参考信息的作用
1. 工作流理解 ：通过工作流配置和描述，模型能够理解被测系统的功能和结构
2. 历史学习 ：通过历史经验，模型能够避免重复之前的错误，优化测试策略
3. 多样性保证 ：通过参考多个历史记录，模型能够生成多样化的测试场景
4. 持续改进 ：通过前一次尝试的反馈，模型能够持续改进测试方法
## 5. 数据流转过程
1. 配置读取 ：从工作流配置文件读取原始配置
2. 配置总结 ：通过 LLM 对配置进行清理和总结，生成 cleaned_config_text 和 description
3. 历史收集 ：从之前的测试记录中收集历史经验
4. 提示词构建 ：将上述信息整合到提示词中
5. 模型调用 ：将提示词发送给 LLM，生成新的测试 idea
6. 执行评估 ：执行测试并评估结果，为下一次迭代提供参考
通过这种方式，模型能够基于系统理解和历史经验，生成更有针对性、更有效的安全测试 idea。